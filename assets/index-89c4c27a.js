import{d as S,r as U,c as F,w as G,p as T,a as R,b as L,e as a,f as l,o as D,m as P,g as A,i as y,h as I,j as s,t as N,u as B,k as o,l as z,n as H,q as p,v as _,_ as J}from"./index-5dfb1015.js";const g=S({__name:"EditTable",props:{dataSource:{default:()=>[]},request:{}},setup(C,{expose:f}){const E=C,r=U({model:[]}),m=U(),v=U(new Set),w=F(()=>r.value.model.map(({data:n})=>n)),k=F(()=>r.value.model.reduce((n,c)=>(c.isNew||n.push({...c.data}),n),[])),d=n=>n.map(c=>({data:{...c},formData:{...c},isEditing:!1,isNew:!1}));G(async()=>{const n=[...E.dataSource];typeof E.request=="function"&&n.push(...await Promise.resolve(E.request())),r.value.model=d(n)});const h=n=>Array.from(v.value).map(c=>`model.${n}.formData.${c}`),M={addRow:(n={})=>{r.value.model.push({data:{...n},formData:{...n},isEditing:!0,isNew:!0})},deleteRow:n=>{r.value.model.splice(n,1)},startEditable:n=>{r.value.model[n].isEditing=!0},cancelEditable:n=>{if(!m.value)return;m.value.resetFields&&m.value.resetFields(h(n));const c=r.value.model[n];c.formData={...c.data},c.isNew?r.value.model.splice(n,1):c.isEditing=!1},saveEditable:n=>{m.value&&m.value.validateField&&m.value.validateField(h(n),c=>{if(!c)return;const $=r.value.model[n];$.data={...$.formData},$.isEditing=!1,$.isNew=!1})}};return T("formModel",r),T("formProps",v),T("editActions",M),f({resultData:k,editActions:M}),(n,c)=>{const $=R("el-table"),j=R("el-form");return D(),L("div",null,[a(j,{ref_key:"form",ref:m,model:r.value},{default:l(()=>[a($,P(n.$attrs,{data:w.value}),{default:l(()=>[A(n.$slots,"default")]),_:3},16,["data"])]),_:3},8,["model"])])}}}),i=S({__name:"EditTableColumn",props:{prop:{default:""},label:{default:""},width:{},rules:{}},setup(C){const f=C,E={addRow:()=>{},deleteRow:()=>{},startEditable:()=>{},cancelEditable:()=>{},saveEditable:()=>{}},r=y("editActions"),m=y("formModel"),v=y("formProps");G(()=>{var e;f.prop&&((e=v==null?void 0:v.value)==null||e.add(f.prop))});const w=e=>{var t;return!m||!((t=m.value)!=null&&t.model)?{isEditing:!1,isNew:!1,formData:{},data:{}}:m.value.model[e]},k=e=>w(e).formData,d=e=>w(e).isEditing??!1,h=e=>{var t;return(t=e.row)==null?void 0:t[f.prop]};return(e,t)=>{const u=R("el-form-item"),q=R("el-table-column");return D(),I(q,P(e.$attrs,{prop:e.prop,label:e.label,width:e.width}),{default:l(b=>[d(b.$index)?(D(),I(u,{key:0,prop:`model.${b.$index}.formData.${e.prop}`,rules:e.rules},{default:l(()=>[A(e.$slots,"edit",{$index:b.$index,row:k(b.$index),column:b.column,actions:B(r)??E},()=>[s(N(h(b)),1)])]),_:2},1032,["prop","rules"])):A(e.$slots,"default",{key:1,$index:b.$index,row:b.row,column:b.column,actions:B(r)??E},()=>[s(N(h(b)),1)])]),_:3},16,["prop","label","width"])}}}),V=C=>(z("data-v-869abe25"),C=C(),H(),C),K={class:"wrapper"},O=V(()=>o("h1",null,"无编辑效果",-1)),Q=V(()=>o("h1",null,"可编辑效果",-1)),W=["onUpdate:modelValue"],X=["onUpdate:modelValue"],Y=["onUpdate:modelValue"],Z=V(()=>o("h1",null,"删除效果",-1)),x=["onUpdate:modelValue"],ee=["onUpdate:modelValue"],te=["onUpdate:modelValue"],le=V(()=>o("h1",null,"新增效果",-1)),ae=["onUpdate:modelValue"],de=["onUpdate:modelValue"],oe=["onUpdate:modelValue"],ne=V(()=>o("h1",null,"表单校验效果",-1)),se=["onUpdate:modelValue"],ie=["onUpdate:modelValue"],ue=["onUpdate:modelValue"],re=V(()=>o("h1",null,"获取编辑结果",-1)),ce=["onUpdate:modelValue"],pe=["onUpdate:modelValue"],_e=["onUpdate:modelValue"],me={class:"result-wrapper"},fe=V(()=>o("h1",null,"另一种数据源配置",-1)),be=S({__name:"index",setup(C){const f=[{date:"2016-05-03",name:"Tom",address:"No. 189, Grove St, Los Angeles"},{date:"2016-05-02",name:"Tom",address:"No. 189, Grove St, Los Angeles"},{date:"2016-05-04",name:"Tom",address:"No. 189, Grove St, Los Angeles"},{date:"2016-05-01",name:"Tom",address:"No. 189, Grove St, Los Angeles"}],E=async()=>f,r=U(),m=U(),v=U();return(w,k)=>{var h;const d=R("el-button");return D(),L("main",K,[o("section",null,[O,a(g,{class:"edit-table","data-source":f},{default:l(()=>[a(i,{prop:"date",label:"时间"}),a(i,{prop:"name",label:"姓名"}),a(i,{prop:"address",label:"地址"})]),_:1})]),o("section",null,[Q,a(g,{class:"edit-table","data-source":f},{default:l(()=>[a(i,{prop:"date",label:"时间"},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.date=t},null,8,W),[[_,e.date]])]),_:1}),a(i,{prop:"name",label:"姓名"},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.name=t},null,8,X),[[_,e.name]])]),_:1}),a(i,{prop:"address",label:"地址"},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.address=t},null,8,Y),[[_,e.address]])]),_:1}),a(i,{label:"修改"},{default:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.startEditable(t)},{default:l(()=>[s("修改")]),_:2},1032,["onClick"])]),edit:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.saveEditable(t)},{default:l(()=>[s("保存")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.cancelEditable(t)},{default:l(()=>[s("取消")]),_:2},1032,["onClick"])]),_:1})]),_:1})]),o("section",null,[Z,a(g,{class:"edit-table","data-source":f},{default:l(()=>[a(i,{prop:"date",label:"时间"},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.date=t},null,8,x),[[_,e.date]])]),_:1}),a(i,{prop:"name",label:"姓名"},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.name=t},null,8,ee),[[_,e.name]])]),_:1}),a(i,{prop:"address",label:"地址"},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.address=t},null,8,te),[[_,e.address]])]),_:1}),a(i,{label:"修改"},{default:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.startEditable(t)},{default:l(()=>[s("修改")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.deleteRow(t)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),edit:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.saveEditable(t)},{default:l(()=>[s("保存")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.cancelEditable(t)},{default:l(()=>[s("取消")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.deleteRow(t)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1})]),o("section",null,[le,a(g,{ref_key:"addEditTableRef",ref:r,class:"edit-table","data-source":f},{default:l(()=>[a(i,{prop:"date",label:"时间"},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.date=t},null,8,ae),[[_,e.date]])]),_:1}),a(i,{prop:"name",label:"姓名"},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.name=t},null,8,de),[[_,e.name]])]),_:1}),a(i,{prop:"address",label:"地址"},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.address=t},null,8,oe),[[_,e.address]])]),_:1}),a(i,{label:"修改"},{default:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.startEditable(t)},{default:l(()=>[s("修改")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.deleteRow(t)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),edit:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.saveEditable(t)},{default:l(()=>[s("保存")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.cancelEditable(t)},{default:l(()=>[s("取消")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.deleteRow(t)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},512),a(d,{onClick:k[0]||(k[0]=e=>{var t;return(t=r.value)==null?void 0:t.editActions.addRow()})},{default:l(()=>[s("新增")]),_:1})]),o("section",null,[ne,a(g,{ref_key:"formEditTableRef",ref:m,class:"edit-table","data-source":f},{default:l(()=>[a(i,{prop:"date",label:"时间",rules:[{required:!0,message:"时间是必填项",trigger:"blur"}]},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.date=t},null,8,se),[[_,e.date]])]),_:1}),a(i,{prop:"name",label:"姓名",rules:[{required:!0,message:"姓名是必填项",trigger:"blur"}]},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.name=t},null,8,ie),[[_,e.name]])]),_:1}),a(i,{prop:"address",label:"地址",rules:[{required:!0,message:"地址是必填项",trigger:"blur"}]},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.address=t},null,8,ue),[[_,e.address]])]),_:1}),a(i,{label:"修改"},{default:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.startEditable(t)},{default:l(()=>[s("修改")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.deleteRow(t)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),edit:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.saveEditable(t)},{default:l(()=>[s("保存")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.cancelEditable(t)},{default:l(()=>[s("取消")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.deleteRow(t)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},512),a(d,{onClick:k[1]||(k[1]=e=>{var t;return(t=m.value)==null?void 0:t.editActions.addRow()})},{default:l(()=>[s("新增")]),_:1})]),o("section",null,[re,a(g,{ref_key:"resultEditTableRef",ref:v,class:"edit-table","data-source":f},{default:l(()=>[a(i,{prop:"date",label:"时间",rules:[{required:!0,message:"时间是必填项",trigger:"blur"}]},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.date=t},null,8,ce),[[_,e.date]])]),_:1}),a(i,{prop:"name",label:"姓名",rules:[{required:!0,message:"姓名是必填项",trigger:"blur"}]},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.name=t},null,8,pe),[[_,e.name]])]),_:1}),a(i,{prop:"address",label:"地址",rules:[{required:!0,message:"地址是必填项",trigger:"blur"}]},{edit:l(({row:e})=>[p(o("input",{"onUpdate:modelValue":t=>e.address=t},null,8,_e),[[_,e.address]])]),_:1}),a(i,{label:"操作"},{default:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.startEditable(t)},{default:l(()=>[s("操作")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.deleteRow(t)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),edit:l(({actions:e,$index:t})=>[a(d,{onClick:u=>e.saveEditable(t)},{default:l(()=>[s("保存")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.cancelEditable(t)},{default:l(()=>[s("取消")]),_:2},1032,["onClick"]),a(d,{onClick:u=>e.deleteRow(t)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},512),a(d,{onClick:k[2]||(k[2]=e=>{var t;return(t=v.value)==null?void 0:t.editActions.addRow()})},{default:l(()=>[s("新增")]),_:1}),o("div",me,"获取数据:"+N((h=v.value)==null?void 0:h.resultData),1)]),o("section",null,[fe,a(g,{class:"edit-table",request:E},{default:l(()=>[a(i,{prop:"date",label:"时间"}),a(i,{prop:"name",label:"姓名"}),a(i,{prop:"address",label:"地址"})]),_:1})])])}}});const ke=J(be,[["__scopeId","data-v-869abe25"]]);export{ke as default};
