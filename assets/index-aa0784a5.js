import{r as c,c as i,s as G,w as F,x as H,y as O,z as W,d as z,A as P,b as v,g as C,F as A,B as j,u as k,C as E,o as d,j as q,t as B,_ as V,h as U,f as $,k as I,l as J,n as K}from"./index-5dfb1015.js";const Q=({containerRef:a,itemMinWidth:p,itemMinHeight:t,rowGap:l,columnGap:n,data:u})=>{const o=document.createElement("div");o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.right="0",o.style.zIndex="-1";const _=c(0),h=c(0),m=c(0),g=c(0),b=c(0),f=i(()=>Math.floor((h.value-p.value)/(p.value+n.value))+1),S=i(()=>Math.ceil(u.value.length/f.value)),x=i(()=>Math.max(S.value*t.value+(S.value-1)*l.value,0)),M=i(()=>Math.ceil((_.value-t.value)/(t.value+l.value))+1),L=i(()=>M.value*f.value);G(()=>x.value,()=>{o.style.height=`${x.value}px`}),F(()=>{g.value=m.value+L.value});const N=()=>{W(()=>{a.value&&(_.value=a.value.clientHeight,h.value=a.value.clientWidth)})},w=()=>{if(!a.value)return;const e=a.value.scrollTop,s=Math.ceil((e-t.value)/(t.value+l.value));m.value=s*f.value,b.value=e-e%(t.value+l.value)},r=new ResizeObserver(N);return H(()=>{a.value&&(a.value.appendChild(o),r.observe(a.value),a.value.addEventListener("scroll",e=>{e.preventDefault(),w()}),w())}),O(()=>{r.disconnect()}),{startIndex:m,endIndex:g,startOffset:b,listHeight:x}},X={key:0},Y={key:1,class:"list"},Z=["onClick"],R={key:2,class:"bottom"},ee={key:3,class:"bottom"},te=z({__name:"GridList",props:{dataSource:{default:()=>[]},request:{type:Function,default:()=>({data:[],total:0})},limit:{default:50},itemMinWidth:{default:200},itemMinHeight:{default:200},rowGap:{default:0},columnGap:{default:0},loadDistance:{default:0}},emits:["onSelectChange"],setup(a,{emit:p}){const t=a;P(e=>({"7934aa86":m.value,e0fe99e0:g.value,"99b3c92c":b.value,"903d49dc":f.value,"3e4f98df":k(M),"314718db":k(L)}));const l=c(),n=c(!1),u=c([]),o=c(0),_=c(1),h=i(()=>o.value===0||u.value.length>=o.value||u.value.length<t.limit),m=i(()=>r(t.itemMinWidth)),g=i(()=>r(t.itemMinHeight)),b=i(()=>r(t.columnGap)),f=i(()=>r(t.rowGap)),{startIndex:S,endIndex:x,startOffset:M,listHeight:L}=Q({containerRef:l,data:u,itemMinWidth:m,itemMinHeight:g,columnGap:b,rowGap:f});G(()=>t.dataSource,e=>{u.value=[...e]},{immediate:!0}),G(()=>t.request,()=>{w()},{immediate:!0});function N(e){e.preventDefault();const s=e.target;s.scrollTop+s.clientHeight>=s.scrollHeight-t.loadDistance&&!n.value&&!h.value&&w()}async function w(){n.value=!0;const e=await Promise.resolve(t.request({limit:t.limit,page:_.value}));o.value=e.total,u.value.push(...e.data),h.value||(_.value=_.value+1),n.value=!1}function r(e){if(typeof e=="number")return e;if(!l.value)return 0;let s=l.value.querySelector("#shadow");s||(s=document.createElement("div"),s.style.position="absolute",s.style.visibility="hidden",l.value.appendChild(s)),s.style.width=e;const y=getComputedStyle(s);return parseFloat(y.width)}return(e,s)=>(d(),v("div",{ref_key:"containerRef",ref:l,class:"infinite-list-wrapper",onScroll:N},[u.value.length===0&&!n.value?(d(),v("div",X,[C(e.$slots,"empty",{},()=>[q("No Data")],!0)])):(d(),v("div",Y,[(d(!0),v(A,null,j(u.value.slice(k(S),k(x)),(y,D)=>(d(),v("div",{key:D,onClick:ce=>p("onSelectChange",y)},[C(e.$slots,"default",{item:y,index:D},()=>[q(B(y),1)],!0)],8,Z))),128))])),n.value?(d(),v("div",R,[C(e.$slots,"loading",{},void 0,!0)])):E("",!0),h.value&&u.value.length>0?(d(),v("div",ee,[C(e.$slots,"noMore",{},void 0,!0)])):E("",!0)],544))}});const ae=V(te,[["__scopeId","data-v-a8b889e7"]]),T=a=>(J("data-v-e845596b"),a=a(),K(),a),le=T(()=>I("p",null,"暂无数据",-1)),se={class:"item"},oe=T(()=>I("p",null,"加载中...",-1)),ne=T(()=>I("p",null,"没有更多了",-1)),ue=z({__name:"index",setup(a){const p=({page:t,limit:l})=>new Promise(n=>{console.log("开始加载啦",t,l),setTimeout(()=>{n({data:Array.from({length:l},(u,o)=>o+(t-1)*l),total:300})},1e3)});return(t,l)=>(d(),U(ae,{request:p,"column-gap":20,"row-gap":20,limit:1e4,"item-min-width":200,class:"grid-list"},{empty:$(()=>[le]),default:$(({item:n})=>[I("div",se,B(n),1)]),loading:$(()=>[oe]),noMore:$(()=>[ne]),_:1}))}});const de=V(ue,[["__scopeId","data-v-e845596b"]]);export{de as default};
